---
const { formTitle, formSubtitle, rulesButton, rulesRequired, startButton, form, rules } = Astro.props;
---

<section id="contact-form-section" class="bg-white px-6 py-16 dark:bg-black">
  <div class="mx-auto max-w-4xl">
    <!-- Form Container -->
    <div class="rounded-3xl border border-neutral-200 bg-gradient-to-br from-neutral-50 to-white p-8 md:p-12 dark:border-neutral-700 dark:from-neutral-900 dark:to-neutral-800">
      <div class="mb-8 text-center">
        <h2 class="mb-3 text-3xl font-bold tracking-tight text-neutral-900 dark:text-neutral-100">{formTitle}</h2>
        <p class="text-neutral-600 dark:text-neutral-400">{formSubtitle}</p>
      </div>

      <!-- Rules Reading Requirement -->
      <div id="rules-section" class="mb-8 rounded-2xl border border-orange-200 bg-gradient-to-r from-orange-50 to-amber-50 p-6 dark:border-orange-800 dark:from-orange-950 dark:to-amber-950">
        <div class="flex items-start gap-4">
          <div class="flex-shrink-0">
            <div class="flex h-10 w-10 items-center justify-center rounded-full bg-orange-500/20">
              <svg class="h-5 w-5 text-orange-600 dark:text-orange-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-2.5L13.732 4c-.77-.833-1.732-.833-2.5 0L4.314 16.5c-.77.833.192 2.5 1.732 2.5z"></path>
              </svg>
            </div>
          </div>
          <div class="flex-1">
            <h3 class="mb-2 font-semibold text-orange-900 dark:text-orange-100">Prima di iniziare</h3>
            <p class="mb-4 text-sm text-orange-800 dark:text-orange-200">{rulesRequired}</p>
            <button id="open-rules-btn" class="inline-flex items-center gap-2 rounded-full bg-gradient-to-r from-orange-600 to-amber-600 px-6 py-3 text-sm font-semibold text-white transition-all duration-200 hover:from-orange-700 hover:to-amber-700 dark:from-orange-500 dark:to-amber-500 dark:hover:from-orange-600 dark:hover:to-amber-600">
              <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z"></path>
              </svg>
              {rulesButton}
            </button>
          </div>
        </div>
      </div>

      <!-- Form -->
      <form id="contact-form" class="hidden">
        <!-- Progress Bar -->
        <div class="mb-8">
          <div class="flex justify-between text-xs font-medium text-neutral-600 dark:text-neutral-400">
            <span id="step-1-label" class="step-label active">{form.steps.personal}</span>
            <span id="step-2-label" class="step-label">{form.steps.project}</span>
            <span id="step-3-label" class="step-label">{form.steps.budget}</span>
            <span id="step-4-label" class="step-label">{form.steps.rules}</span>
          </div>
          <div class="mt-2 h-2 rounded-full bg-neutral-200 dark:bg-neutral-700">
            <div id="progress-bar" class="h-2 rounded-full bg-gradient-to-r from-sky-500 to-blue-500 transition-all duration-300" style="width: 25%"></div>
          </div>
        </div>

        <!-- Step 1: Personal Info -->
        <div id="step-1" class="form-step">
          <h3 class="mb-6 text-xl font-bold text-neutral-900 dark:text-neutral-100">{form.step1.title}</h3>
          <div class="grid gap-4 md:grid-cols-2">
            <div class="md:col-span-1">
              <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300">{form.step1.name} *</label>
              <input type="text" required class="mt-1 block w-full rounded-xl border border-neutral-300 bg-white px-4 py-3 text-neutral-900 placeholder-neutral-500 transition-colors focus:border-sky-500 focus:ring-1 focus:ring-sky-500 focus:outline-none dark:border-neutral-600 dark:bg-neutral-800 dark:text-neutral-100 dark:placeholder-neutral-400" />
            </div>
            <div class="md:col-span-1">
              <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300">{form.step1.email} *</label>
              <input type="email" required class="mt-1 block w-full rounded-xl border border-neutral-300 bg-white px-4 py-3 text-neutral-900 placeholder-neutral-500 transition-colors focus:border-sky-500 focus:ring-1 focus:ring-sky-500 focus:outline-none dark:border-neutral-600 dark:bg-neutral-800 dark:text-neutral-100 dark:placeholder-neutral-400" />
            </div>
            <div class="md:col-span-1">
              <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300">{form.step1.company}</label>
              <input type="text" class="mt-1 block w-full rounded-xl border border-neutral-300 bg-white px-4 py-3 text-neutral-900 placeholder-neutral-500 transition-colors focus:border-sky-500 focus:ring-1 focus:ring-sky-500 focus:outline-none dark:border-neutral-600 dark:bg-neutral-800 dark:text-neutral-100 dark:placeholder-neutral-400" />
            </div>
            <div class="md:col-span-1">
              <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300">{form.step1.role} *</label>
              <input type="text" required class="mt-1 block w-full rounded-xl border border-neutral-300 bg-white px-4 py-3 text-neutral-900 placeholder-neutral-500 transition-colors focus:border-sky-500 focus:ring-1 focus:ring-sky-500 focus:outline-none dark:border-neutral-600 dark:bg-neutral-800 dark:text-neutral-100 dark:placeholder-neutral-400" />
            </div>
          </div>
        </div>

        <!-- Step 2: Project Info -->
        <div id="step-2" class="form-step hidden">
          <h3 class="mb-6 text-xl font-bold text-neutral-900 dark:text-neutral-100">{form.step2.title}</h3>
          <div class="space-y-4">
            <div>
              <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300">{form.step2.type} *</label>
              <select required class="mt-1 block w-full rounded-xl border border-neutral-300 bg-white px-4 py-3 text-neutral-900 transition-colors focus:border-sky-500 focus:ring-1 focus:ring-sky-500 focus:outline-none dark:border-neutral-600 dark:bg-neutral-800 dark:text-neutral-100">
                <option value="">{form.step2.type}</option>
                <option value="new">{form.step2.typeOptions.new}</option>
                <option value="redesign">{form.step2.typeOptions.redesign}</option>
                <option value="maintenance">{form.step2.typeOptions.maintenance}</option>
                <option value="seo">{form.step2.typeOptions.seo}</option>
                <option value="other">{form.step2.typeOptions.other}</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300">{form.step2.description} *</label>
              <textarea required rows="4" class="mt-1 block w-full rounded-xl border border-neutral-300 bg-white px-4 py-3 text-neutral-900 placeholder-neutral-500 transition-colors focus:border-sky-500 focus:ring-1 focus:ring-sky-500 focus:outline-none dark:border-neutral-600 dark:bg-neutral-800 dark:text-neutral-100 dark:placeholder-neutral-400"></textarea>
            </div>
            <div>
              <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300">{form.step2.goals} *</label>
              <textarea required rows="3" class="mt-1 block w-full rounded-xl border border-neutral-300 bg-white px-4 py-3 text-neutral-900 placeholder-neutral-500 transition-colors focus:border-sky-500 focus:ring-1 focus:ring-sky-500 focus:outline-none dark:border-neutral-600 dark:bg-neutral-800 dark:text-neutral-100 dark:placeholder-neutral-400"></textarea>
            </div>
          </div>
        </div>

        <!-- Step 3: Budget & Timeline -->
        <div id="step-3" class="form-step hidden">
          <h3 class="mb-6 text-xl font-bold text-neutral-900 dark:text-neutral-100">{form.step3.title}</h3>
          <div class="grid gap-4 md:grid-cols-2">
            <div>
              <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300">{form.step3.budget} *</label>
              <select required class="mt-1 block w-full rounded-xl border border-neutral-300 bg-white px-4 py-3 text-neutral-900 transition-colors focus:border-sky-500 focus:ring-1 focus:ring-sky-500 focus:outline-none dark:border-neutral-600 dark:bg-neutral-800 dark:text-neutral-100">
                <option value="">{form.step3.budget}</option>
                <option value="under1500">{form.step3.budgetOptions.under1500}</option>
                <option value="range1500">{form.step3.budgetOptions.range1500}</option>
                <option value="range3000">{form.step3.budgetOptions.range3000}</option>
                <option value="over5000">{form.step3.budgetOptions.over5000}</option>
                <option value="discuss">{form.step3.budgetOptions.discuss}</option>
              </select>
            </div>
            <div>
              <label class="block text-sm font-medium text-neutral-700 dark:text-neutral-300">{form.step3.timeline} *</label>
              <select required class="mt-1 block w-full rounded-xl border border-neutral-300 bg-white px-4 py-3 text-neutral-900 transition-colors focus:border-sky-500 focus:ring-1 focus:ring-sky-500 focus:outline-none dark:border-neutral-600 dark:bg-neutral-800 dark:text-neutral-100">
                <option value="">{form.step3.timeline}</option>
                <option value="asap">{form.step3.timelineOptions.asap}</option>
                <option value="month1">{form.step3.timelineOptions.month1}</option>
                <option value="month3">{form.step3.timelineOptions.month3}</option>
                <option value="flexible">{form.step3.timelineOptions.flexible}</option>
              </select>
            </div>
          </div>
        </div>

        <!-- Step 4: Rules & Confirmation -->
        <div id="step-4" class="form-step hidden">
          <h3 class="mb-6 text-xl font-bold text-neutral-900 dark:text-neutral-100">{form.step4.title}</h3>
          <div class="space-y-4">
            <div class="flex items-start gap-3">
              <input type="checkbox" id="rules-checkbox" required class="mt-1 h-4 w-4 rounded border-neutral-300 text-sky-600 focus:ring-sky-500" />
              <label for="rules-checkbox" class="text-sm text-neutral-700 dark:text-neutral-300">{form.step4.rulesAccepted}</label>
            </div>
            <div class="flex items-start gap-3">
              <input type="checkbox" id="privacy-checkbox" required class="mt-1 h-4 w-4 rounded border-neutral-300 text-sky-600 focus:ring-sky-500" />
              <label for="privacy-checkbox" class="text-sm text-neutral-700 dark:text-neutral-300">{form.step4.dataProcessing}</label>
            </div>
          </div>
        </div>

        <!-- Navigation -->
        <div class="mt-8 flex justify-between">
          <button type="button" id="prev-btn" class="hidden rounded-full border border-neutral-300 bg-white px-6 py-3 text-sm font-semibold text-neutral-700 transition-all duration-200 hover:bg-neutral-50 dark:border-neutral-600 dark:bg-neutral-800 dark:text-neutral-300 dark:hover:bg-neutral-700">
            {form.navigation.prev}
          </button>
          <div class="flex-1"></div>
          <button type="button" id="next-btn" class="rounded-full bg-gradient-to-r from-sky-500 to-blue-500 px-6 py-3 text-sm font-semibold text-white transition-all duration-200 hover:from-sky-600 hover:to-blue-600">
            {form.navigation.next}
          </button>
          <button type="submit" id="submit-btn" class="hidden rounded-full bg-gradient-to-r from-sky-500 to-blue-500 px-6 py-3 text-sm font-semibold text-white transition-all duration-200 hover:from-sky-600 hover:to-blue-600">
            {form.navigation.submit}
          </button>
        </div>
      </form>

      <!-- Success/Error State -->
      <div id="form-success" class="hidden text-center">
        <div class="mx-auto mb-4 flex h-16 w-16 items-center justify-center rounded-full bg-green-100 dark:bg-green-900">
          <svg class="h-8 w-8 text-green-600 dark:text-green-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"></path>
          </svg>
        </div>
        <h3 class="mb-2 text-xl font-bold text-neutral-900 dark:text-neutral-100">Richiesta inviata!</h3>
        <p class="text-neutral-700 dark:text-neutral-400">Ti contatterò entro 48 ore per valutare la collaborazione.</p>
      </div>
    </div>
  </div>
</section>

<!-- Rules Modal -->
<div id="rules-modal" class="fixed inset-0 z-50 hidden items-center justify-center bg-black/50 backdrop-blur-sm">
  <div class="mx-4 max-h-[90vh] w-full max-w-4xl overflow-y-auto rounded-3xl bg-white dark:bg-neutral-900">
    <div class="sticky top-0 flex items-center justify-between border-b border-neutral-200 bg-white px-6 py-4 dark:border-neutral-700 dark:bg-neutral-900">
      <h2 class="text-2xl font-bold text-neutral-900 dark:text-neutral-100">{rules.title}</h2>
      <button id="close-rules-btn" class="rounded-full p-2 text-neutral-500 transition-colors hover:bg-neutral-100 dark:text-neutral-400 dark:hover:bg-neutral-800">
        <svg class="h-6 w-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
      </button>
    </div>

    <div class="p-6 md:p-8">
      <p class="mb-8 text-lg text-neutral-700 dark:text-neutral-300">{rules.subtitle}</p>

      <div class="space-y-8">
        {
          rules.sections.map((section) => (
            <div class="rounded-2xl border border-neutral-200 bg-gradient-to-br from-neutral-50 to-white p-6 dark:border-neutral-700 dark:from-neutral-800 dark:to-neutral-900">
              <h3 class="mb-4 text-xl font-bold text-neutral-900 dark:text-neutral-100">{section.title}</h3>
              <ul class="space-y-3">
                {section.rules.map((rule) => (
                  <li class="flex items-start gap-3">
                    <svg class="mt-1 h-5 w-5 flex-shrink-0 text-sky-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" />
                    </svg>
                    <span class="text-neutral-700 dark:text-neutral-300">{rule}</span>
                  </li>
                ))}
              </ul>
            </div>
          ))
        }
      </div>

      <div class="mt-8 rounded-2xl border border-sky-200 bg-gradient-to-r from-sky-50 to-blue-50 p-6 dark:border-sky-800 dark:from-sky-950 dark:to-blue-950">
        <div class="flex items-start gap-3">
          <input type="checkbox" id="rules-agreement" class="mt-1 h-5 w-5 rounded border-sky-300 text-sky-600 focus:ring-sky-500" />
          <label for="rules-agreement" class="text-sky-900 dark:text-sky-100">{rules.agreement}</label>
        </div>
      </div>

      <div class="mt-6 flex justify-end gap-4">
        <button id="close-rules-btn-2" class="rounded-full border border-neutral-300 bg-white px-6 py-3 text-sm font-semibold text-neutral-700 transition-colors duration-200 hover:bg-neutral-50 dark:border-neutral-600 dark:bg-neutral-800 dark:text-neutral-300 dark:hover:bg-neutral-700">
          {rules.close}
        </button>
        <button id="accept-rules-btn" class="rounded-full bg-gradient-to-r from-sky-500 to-blue-500 px-6 py-3 text-sm font-semibold text-white transition-all duration-200 hover:from-sky-600 hover:to-blue-600 disabled:cursor-not-allowed disabled:opacity-50" disabled>
          {startButton}
        </button>
      </div>
    </div>
  </div>
</div>

<!-- <style>
  .step-label.active {
    @apply font-semibold text-sky-600 dark:text-sky-400;
  }

  .form-step {
    @apply transition-all duration-300;
  }
</style> -->
